{"ast":null,"code":"// Email Alert Service using EmailJS\nimport emailjs from '@emailjs/browser';\n\n// EmailJS Configuration\nconst EMAILJS_SERVICE_ID = 'service_yfmjx33';\nconst EMAILJS_TEMPLATE_ID = 'template_jme47e2';\nconst EMAILJS_PUBLIC_KEY = '-2IqAe8bnT8xi5PGN';\n\n// Alert cooldown (prevent spam) - 1 hour\nconst ALERT_COOLDOWN_MS = 60 * 60 * 1000;\n\n// Get last alert time from localStorage\nconst getLastAlertTime = location => {\n  const key = `lastAlert_${location}`;\n  const stored = localStorage.getItem(key);\n  return stored ? parseInt(stored, 10) : 0;\n};\n\n// Set last alert time\nconst setLastAlertTime = location => {\n  const key = `lastAlert_${location}`;\n  localStorage.setItem(key, Date.now().toString());\n};\n\n// Check if alert can be sent (cooldown passed)\nconst canSendAlert = location => {\n  const lastTime = getLastAlertTime(location);\n  return Date.now() - lastTime > ALERT_COOLDOWN_MS;\n};\n\n// Get user's alert preferences from localStorage\nexport const getAlertPreferences = () => {\n  const stored = localStorage.getItem('alertPreferences');\n  if (stored) {\n    return JSON.parse(stored);\n  }\n  return {\n    enabled: false,\n    threshold: 150 // Default: Unhealthy\n  };\n};\n\n// Save alert preferences\nexport const saveAlertPreferences = prefs => {\n  localStorage.setItem('alertPreferences', JSON.stringify(prefs));\n};\n\n// Get AQI category\nconst getAQICategory = aqi => {\n  if (aqi <= 50) return 'Good';\n  if (aqi <= 100) return 'Moderate';\n  if (aqi <= 150) return 'Unhealthy for Sensitive Groups';\n  if (aqi <= 200) return 'Unhealthy';\n  if (aqi <= 300) return 'Very Unhealthy';\n  return 'Hazardous';\n};\n\n// Get health recommendations\nconst getHealthRecommendations = aqi => {\n  if (aqi <= 100) return 'Air quality is acceptable. Enjoy outdoor activities.';\n  if (aqi <= 150) return 'Sensitive individuals should reduce prolonged outdoor exertion.';\n  if (aqi <= 200) return 'Everyone may experience health effects. Limit outdoor activity.';\n  if (aqi <= 300) return 'Health alert! Everyone may experience serious effects. Avoid outdoor activity.';\n  return 'Emergency! Serious health effects for everyone. Stay indoors!';\n};\n\n// Send email alert\nexport const sendAQIAlert = async (userEmail, userName, aqi, location) => {\n  // Check if alerts are enabled\n  const prefs = getAlertPreferences();\n  if (!prefs.enabled) {\n    console.log('[Alert] Alerts are disabled');\n    return {\n      success: false,\n      reason: 'disabled'\n    };\n  }\n\n  // Check if AQI exceeds threshold\n  if (aqi < prefs.threshold) {\n    console.log(`[Alert] AQI ${aqi} is below threshold ${prefs.threshold}`);\n    return {\n      success: false,\n      reason: 'below_threshold'\n    };\n  }\n\n  // Check cooldown\n  if (!canSendAlert(location)) {\n    console.log('[Alert] Cooldown active, skipping alert');\n    return {\n      success: false,\n      reason: 'cooldown'\n    };\n  }\n\n  // Prepare email parameters\n  const templateParams = {\n    email: userEmail,\n    user_name: userName || 'User',\n    aqi: String(aqi),\n    location: location,\n    category: getAQICategory(aqi),\n    recommendations: getHealthRecommendations(aqi),\n    threshold: String(prefs.threshold),\n    dashboard_url: window.location.origin\n  };\n  try {\n    console.log('[Alert] Sending email alert to:', userEmail);\n    console.log('[Alert] Template params:', templateParams);\n    const response = await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams, EMAILJS_PUBLIC_KEY);\n    console.log('[Alert] Email sent successfully:', response);\n    setLastAlertTime(location);\n    return {\n      success: true,\n      response\n    };\n  } catch (error) {\n    console.error('[Alert] Failed to send email:', error);\n    return {\n      success: false,\n      error: (error === null || error === void 0 ? void 0 : error.text) || (error === null || error === void 0 ? void 0 : error.message) || 'Unknown error'\n    };\n  }\n};\n\n// Send test alert (ignores cooldown)\nexport const sendTestAlert = async (userEmail, userName) => {\n  const templateParams = {\n    email: userEmail,\n    user_name: userName || 'User',\n    aqi: '175',\n    location: 'Test Location',\n    category: 'Unhealthy',\n    recommendations: 'This is a test alert. Your alert system is working correctly!',\n    threshold: '150',\n    dashboard_url: window.location.origin\n  };\n  try {\n    console.log('[Alert] Sending test email to:', userEmail);\n    console.log('[Alert] Template params:', templateParams);\n    const response = await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams, EMAILJS_PUBLIC_KEY);\n    console.log('[Alert] Test email sent:', response);\n    return {\n      success: true,\n      response\n    };\n  } catch (error) {\n    console.error('[Alert] Test email failed:', error);\n    // Get more detailed error message\n    const errorMessage = (error === null || error === void 0 ? void 0 : error.text) || (error === null || error === void 0 ? void 0 : error.message) || JSON.stringify(error) || 'Unknown error';\n    return {\n      success: false,\n      error: errorMessage\n    };\n  }\n};\nexport default {\n  sendAQIAlert,\n  sendTestAlert,\n  getAlertPreferences,\n  saveAlertPreferences\n};","map":{"version":3,"names":["emailjs","EMAILJS_SERVICE_ID","EMAILJS_TEMPLATE_ID","EMAILJS_PUBLIC_KEY","ALERT_COOLDOWN_MS","getLastAlertTime","location","key","stored","localStorage","getItem","parseInt","setLastAlertTime","setItem","Date","now","toString","canSendAlert","lastTime","getAlertPreferences","JSON","parse","enabled","threshold","saveAlertPreferences","prefs","stringify","getAQICategory","aqi","getHealthRecommendations","sendAQIAlert","userEmail","userName","console","log","success","reason","templateParams","email","user_name","String","category","recommendations","dashboard_url","window","origin","response","send","error","text","message","sendTestAlert","errorMessage"],"sources":["D:/AQI_Index/AQI-RealTime-System/frontend/src/services/alertService.js"],"sourcesContent":["// Email Alert Service using EmailJS\r\nimport emailjs from '@emailjs/browser';\r\n\r\n// EmailJS Configuration\r\nconst EMAILJS_SERVICE_ID = 'service_yfmjx33';\r\nconst EMAILJS_TEMPLATE_ID = 'template_jme47e2';\r\nconst EMAILJS_PUBLIC_KEY = '-2IqAe8bnT8xi5PGN';\r\n\r\n// Alert cooldown (prevent spam) - 1 hour\r\nconst ALERT_COOLDOWN_MS = 60 * 60 * 1000;\r\n\r\n// Get last alert time from localStorage\r\nconst getLastAlertTime = (location) => {\r\n    const key = `lastAlert_${location}`;\r\n    const stored = localStorage.getItem(key);\r\n    return stored ? parseInt(stored, 10) : 0;\r\n};\r\n\r\n// Set last alert time\r\nconst setLastAlertTime = (location) => {\r\n    const key = `lastAlert_${location}`;\r\n    localStorage.setItem(key, Date.now().toString());\r\n};\r\n\r\n// Check if alert can be sent (cooldown passed)\r\nconst canSendAlert = (location) => {\r\n    const lastTime = getLastAlertTime(location);\r\n    return Date.now() - lastTime > ALERT_COOLDOWN_MS;\r\n};\r\n\r\n// Get user's alert preferences from localStorage\r\nexport const getAlertPreferences = () => {\r\n    const stored = localStorage.getItem('alertPreferences');\r\n    if (stored) {\r\n        return JSON.parse(stored);\r\n    }\r\n    return {\r\n        enabled: false,\r\n        threshold: 150, // Default: Unhealthy\r\n    };\r\n};\r\n\r\n// Save alert preferences\r\nexport const saveAlertPreferences = (prefs) => {\r\n    localStorage.setItem('alertPreferences', JSON.stringify(prefs));\r\n};\r\n\r\n// Get AQI category\r\nconst getAQICategory = (aqi) => {\r\n    if (aqi <= 50) return 'Good';\r\n    if (aqi <= 100) return 'Moderate';\r\n    if (aqi <= 150) return 'Unhealthy for Sensitive Groups';\r\n    if (aqi <= 200) return 'Unhealthy';\r\n    if (aqi <= 300) return 'Very Unhealthy';\r\n    return 'Hazardous';\r\n};\r\n\r\n// Get health recommendations\r\nconst getHealthRecommendations = (aqi) => {\r\n    if (aqi <= 100) return 'Air quality is acceptable. Enjoy outdoor activities.';\r\n    if (aqi <= 150) return 'Sensitive individuals should reduce prolonged outdoor exertion.';\r\n    if (aqi <= 200) return 'Everyone may experience health effects. Limit outdoor activity.';\r\n    if (aqi <= 300) return 'Health alert! Everyone may experience serious effects. Avoid outdoor activity.';\r\n    return 'Emergency! Serious health effects for everyone. Stay indoors!';\r\n};\r\n\r\n// Send email alert\r\nexport const sendAQIAlert = async (userEmail, userName, aqi, location) => {\r\n    // Check if alerts are enabled\r\n    const prefs = getAlertPreferences();\r\n    if (!prefs.enabled) {\r\n        console.log('[Alert] Alerts are disabled');\r\n        return { success: false, reason: 'disabled' };\r\n    }\r\n\r\n    // Check if AQI exceeds threshold\r\n    if (aqi < prefs.threshold) {\r\n        console.log(`[Alert] AQI ${aqi} is below threshold ${prefs.threshold}`);\r\n        return { success: false, reason: 'below_threshold' };\r\n    }\r\n\r\n    // Check cooldown\r\n    if (!canSendAlert(location)) {\r\n        console.log('[Alert] Cooldown active, skipping alert');\r\n        return { success: false, reason: 'cooldown' };\r\n    }\r\n\r\n    // Prepare email parameters\r\n    const templateParams = {\r\n        email: userEmail,\r\n        user_name: userName || 'User',\r\n        aqi: String(aqi),\r\n        location: location,\r\n        category: getAQICategory(aqi),\r\n        recommendations: getHealthRecommendations(aqi),\r\n        threshold: String(prefs.threshold),\r\n        dashboard_url: window.location.origin,\r\n    };\r\n\r\n    try {\r\n        console.log('[Alert] Sending email alert to:', userEmail);\r\n        console.log('[Alert] Template params:', templateParams);\r\n\r\n        const response = await emailjs.send(\r\n            EMAILJS_SERVICE_ID,\r\n            EMAILJS_TEMPLATE_ID,\r\n            templateParams,\r\n            EMAILJS_PUBLIC_KEY\r\n        );\r\n\r\n        console.log('[Alert] Email sent successfully:', response);\r\n        setLastAlertTime(location);\r\n\r\n        return { success: true, response };\r\n    } catch (error) {\r\n        console.error('[Alert] Failed to send email:', error);\r\n        return { success: false, error: error?.text || error?.message || 'Unknown error' };\r\n    }\r\n};\r\n\r\n// Send test alert (ignores cooldown)\r\nexport const sendTestAlert = async (userEmail, userName) => {\r\n    const templateParams = {\r\n        email: userEmail,\r\n        user_name: userName || 'User',\r\n        aqi: '175',\r\n        location: 'Test Location',\r\n        category: 'Unhealthy',\r\n        recommendations: 'This is a test alert. Your alert system is working correctly!',\r\n        threshold: '150',\r\n        dashboard_url: window.location.origin,\r\n    };\r\n\r\n    try {\r\n        console.log('[Alert] Sending test email to:', userEmail);\r\n        console.log('[Alert] Template params:', templateParams);\r\n\r\n        const response = await emailjs.send(\r\n            EMAILJS_SERVICE_ID,\r\n            EMAILJS_TEMPLATE_ID,\r\n            templateParams,\r\n            EMAILJS_PUBLIC_KEY\r\n        );\r\n\r\n        console.log('[Alert] Test email sent:', response);\r\n        return { success: true, response };\r\n    } catch (error) {\r\n        console.error('[Alert] Test email failed:', error);\r\n        // Get more detailed error message\r\n        const errorMessage = error?.text || error?.message || JSON.stringify(error) || 'Unknown error';\r\n        return { success: false, error: errorMessage };\r\n    }\r\n};\r\n\r\nexport default {\r\n    sendAQIAlert,\r\n    sendTestAlert,\r\n    getAlertPreferences,\r\n    saveAlertPreferences,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}